<!DOCTYPE html><html lang="zh-TW" prefix="og: http://ogp.me/ns#"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="author" property="og:article:author" content="gholk">
<meta name="copyright" content="Common Creative">
<meta name="generator" content="emacs, markdown">
<!-- 以上一般不用改，以下才要改。 -->

<!-- 後設資料 -->
<meta name="date" property="og:article:public_time" content="2018-10-16T12:42:11.658Z">
<meta name="keywords" property="og:article:tag" content="adjustment,nctu,report">
<link rel="index" type="text/html" href="index.html" title="首頁">
<link rel="start" type="text/html" href="index.html" title="首頁">
<link rel="next" type="text/html" href="">
<link rel="prev" type="text/html" href="javascript-strict-equality-myth.html" title="全等算符的迷思">

<!-- 和網頁位置有關 -->
<link rel="icon" type="image/png" href="ext/icon.png">
<link rel="apple-touch-icon" type="image/png" href="ext/icon.png">
<link rel="stylesheet" type="text/css" href="ext/padding-lot.css">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="ext/meta-bloging.js"></script>

<title>平差作業三</title>
</head>
<body>
<main><h1 id="平差作業三">平差作業三</h1>
<p>在直角座標與經緯度座標間轉換的誤差傳播，
使用 wgs84 橢球。</p>
<h2 id="直角座標與經緯度座標的轉換關係">直角座標與經緯度座標的轉換關係</h2>
<pre><code class="lang-math">x = (N + h) cos \phi cos \lambda \\
y = (N + h) cos \phi sin \lambda \\
z = (N (1-e^2) + h) sin \phi
</code></pre>
<p>φ λ h 分別為經度、緯度、橢球高，
而 N 為當地 <strong>卯酉圈</strong> 半徑，
也就是在該點上與子午圈截面垂直的切面。</p>
<p>N 的公式如下：</p>
<pre><code class="lang-math">N = \frac a {\sqrt{ 1 - e^2 sin^2 \phi }}
</code></pre>
<pre><code class="lang-matlab">% wgs84 參數
global major_axis flattening first_eccentricity flattening;
major_axis = 6378137;
flattening = 1/298.257223563;
first_eccentricity = sqrt(-flattening^2 + 2*flattening);

function N = radius_N(phi)
  global major_axis first_eccentricity;
  a = major_axis;
  e = first_eccentricity;
  N = a ./ sqrt(1 .- e^2 * sin(phi).^2);
end
</code></pre>
<h2 id="誤差傳播">誤差傳播</h2>
<p>給定一點直角座標 
<code>(1241581.343, -4638917.074, 4183965.568)</code> ，
變方協變方矩陣為：</p>
<pre><code class="lang-math">\Sigma_r = \begin{bmatrix}
9.0 &amp; -0.1 &amp; 0.2 \\
-0.1 &amp; 8.0 &amp; -0.2 \\
0.2 &amp; -0.2 &amp; 9.1
\end{bmatrix} \times 10^{-4} m^2
</code></pre>
<p>以誤差傳播公式由 x y z 求出 φ λ h 的變方協變方矩陣，
以矩陣式來看，需要先求出 xyz 與 φλh 的線性關係式，</p>
<pre><code class="lang-math">A
\begin{bmatrix}
x \\ y \\ z
\end{bmatrix}
= \begin{bmatrix}
\phi \\ \lambda \\ h
\end{bmatrix}
\\

\Sigma_g = A^{-1} \Sigma_r ( A^{-1} )^T
</code></pre>
<p>雖然實際二者非線性關係，但可以用偏微分後線性化近似。
但線性化要有初始值，以下先試著算出 φλh 的初始值。</p>
<h2 id="使用 proj.4 計算經緯度初始值">使用 proj.4 計算經緯度初始值</h2>
<p><a href="http://proj4.org/">proj.4</a> 是 <a href="http://www.osgeo.org/">OSGeo</a> 的專案，
可以在經緯度、直角座標、各地圖投影間轉換。
這裡始用 proj.4 由 XYZ 計算 φλh 的值。</p>
<pre><code class="lang-term">cs2cs +proj=geocent +datum=WGS84 +to \
      +proj=latlong +ellps=WGS84 +datum=WGS84 &lt;&lt;CS
1241581.343 -4638917.074 4183965.568
CS

75d0&#39;58.613&quot;W   41d15&#39;18.211&quot;N 312.391
</code></pre>
<p>得到對應的經緯度是 <code>(75°0′58.613″W   41°15′18.211″N 312.391)</code> ，
或轉成十進位與地理緯度 <code>(-75.0162813888889, 48.7449413888889, 312.391)</code> 。</p>
<h2 id="偏微分">偏微分</h2>
<p>接著計算偏微分，三條公式分別對 φλh 偏微分，
得到線性化的矩陣。這裡使用數值微分。</p>
<pre><code class="lang-matlab">function derive_function = derive (function_handle, interval = 0.005)
  derive_function = @(x) (
    function_handle(x.+interval) - function_handle(x.-interval)
  ) ./ (interval * 2);
end

init_degree = [-75.0162813888889 48.7449413888889 312.391];

geodxyz = {};
geodxyz{1} = @(f,l,h) (radius_N(f)+h) .* cosd(f) .* cosd(l);
geodxyz{2} = @(f,l,h) (radius_N(f)+h) .* cosd(f) .* sind(l);
geodxyz{3} = @(f,l,h) (radius_N(f).*(1-first_eccentricity^2)+h) .* sind(f);

geodpart = {};
for i=1:3
  geodpart{i,1} = derive(@(f) geodxyz{i}(f, init_degree(2), init_degree(3)), 0.000001);
  geodpart{i,2} = derive(@(l) geodxyz{i}(init_degree(1), l, init_degree(3)), 0.000001);
  geodpart{i,3} = derive(@(h) geodxyz{i}(init_degree(1), init_degree(2), h));
end

design_matrix = zeros(3,3);
for i=1:3
  for j=1:3
    design_matrix(i,j) = geodpart{i,j}(init_degree(j));
  end
end
</code></pre>
<p>最後得到線性化的設計矩陣 A：</p>
<pre><code class="lang-math">A = \begin{bmatrix}
73467.2836260870 &amp; -21648.1901006773 &amp; 0.170487421564758 \\
83758.4625696763 &amp; 18988.3346902207 &amp; 0.194369023665786 \\
14413.2366403937 &amp; 0 &amp; -0.965999253094196
\end{bmatrix}
</code></pre>
<h2 id="經緯度的變方協變方矩陣">經緯度的變方協變方矩陣</h2>
<p>有了線性化的設計矩陣，
就能由誤差傳播公式計算得未知數的變方協變方矩陣。</p>
<pre><code class="lang-math">A^{-1} = \begin{bmatrix}
7.3467 \times 10^{4} &amp; -2.1648 \times 10^{4} &amp; 1.7049 \times 10^{-1} \\
8.3758 \times 10^{4} &amp; 1.8988 \times 10^{4} &amp; 1.9437 \times 10^{-1} \\
1.4413 \times 10^{4} &amp; 0.0000 &amp; -9.6600 \times 10^{-1}
\end{bmatrix}
\\
\Sigma_g = A^{-1} \Sigma_r {A^{-1}}^T = \begin{bmatrix}
6.7565 \times 10^{-6} &amp; -1.6818 \times 10^{-6} &amp; -1.1626 \times 10^{-1} \\
-1.6818 \times 10^{-6} &amp; 1.0449 \times 10^{-4} &amp; 7.6370 \times 10^{-2} \\
-1.1626 \times 10^{-1} &amp; 7.6370 \times 10^{-2} &amp; 9.2545 \times 10^{4}
\end{bmatrix}
</code></pre>
<p>其中 φ λ 因為是經緯度，
經緯度的 1° 遠比公尺大，變方較小是正常的。
而橢球高 h 的單位也是公尺，
變方就和原本的 xyz 變方差不多。</p>
</main>

<script defer src="ext/meta-meta.js"></script>
<script defer data-lazy="" src="ext/load-disqus.js"></script>
<script>autoLoader.autoLoad()</script>

</body></html>
