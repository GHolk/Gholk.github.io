<!DOCTYPE html>
<html lang="zh-TW" prefix="og: http://ogp.me/ns#">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="author" property="og:article:author" content="gholk">
    <meta name="copyright" content="Common Creative">
    <!-- 以上一般不用改，以下才要改。 -->

    <!-- 後設資料 -->
    <meta name="date" property="og:article:public_time" content="2017-03-18">
    <meta name="keywords" property="og:article:tag" content="blog,index">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 和網頁位置有關 -->
    <link rel="icon" type="image/png" href="ext/icon.png">
    <link rel="apple-touch-icon" type="image/png" href="ext/icon.png">
    <link rel="stylesheet" type="text/css" href="ext/static-mblog.css">
    <link rel="alternate" href="atom.xml" type="application/atom+xml">
    <script src="ext/meta-bloging.js"></script>
    <title>靜態試驗場 mblog</title>
  </head>
  <body>
    <header>
      <h1>靜態試驗場 mblog</h1>
      <p>mblog is for meta bloging，你的瀏覽器就是我的實驗場。</p>
    </header>
    
    <nav>
      <ul>
        <li><a href="online-web-chat-room.html">聊天室</a></li>
        <li><a href="comment.html">留言板</a></li>
        <li><a href="atom.xml">rss (atom)</a></li>
      </ul>
    </nav>
    
    <blockquote id="daily-sentence">
      <h3><a data-source-list="taiwoman.html key-and-lock.html short-life-expensive-price.html">每日一句</a></h3>
      <script>
        loadDailySentence()
        
        async function loadDailySentence() {
          const day = daySince(new Date('2018-04-12'))
          const article = prevQuerySelector('a')
          const sourceList = article.dataset.sourceList.split(/ /g)
          const source = sourceList[ day % sourceList.length ]
          const container = await fetchDocument(source)
          window.cf = container.firstChild
          const times = Math.floor(day / sourceList.length)
          const sentence = selectSentence(container, times)
          document.querySelector('#daily-sentence').appendChild(sentence)
        
          async function fetchDocument(source) {
            const main = await ajaxQuery(source, 'main')
            const title = main.querySelector('h1')
            const description = main.querySelector('p')
            void [title, description].forEach(node => node && node.remove())
            return main
          }
          function selectSentence(container, times) {
            const hrList = container.querySelectorAll('hr')
            const length = hrList.length + 1
            const count = times % length
            const fragment = document.createDocumentFragment()
            if (count == 0) {
              while (container.firstChild.nodeName != 'HR') {
                fragment.appendChild(container.firstChild)
              }
            }
            else {
              let hr = hrList[count - 1]
              for (let node = hr.nextSibling;
                   node && node.nodeName != 'HR';
                   node = hr.nextSibling) {
                fragment.appendChild(node)
              }
            }
            return fragment
          }
          function daySince(start) {
            const now = new Date()
            const msDiff = Number(now) - Number(start)
            const dayDiff = msDiff / (24 * 60 * 60 * 1000)
            return Math.floor(dayDiff)
          }
        }
      </script>
    </blockquote>
      
    <main></main>
    <template id="article-template">
      <article>
        <h2><a></a></h2>
        <small class="date"></small>
        <p class="summary"></p>
        <ul></ul>
      </article>
    </template>
    <script data-article-count-limit="20"
            src="ext/atom-indexing.js"></script>

    <button onclick="loadMoreArticle(5)">more</button>
    <script>
      function loadMoreArticle(n = 1) {
        return loadArticle.then(list => {
          const convertor = list.convertor
          const newList = []
          for (let i=0; i<n; i++) {
            const article = convertor.next()
            newList.push(article)
          }
          list.push(...newList)
          return newList
        })
      }
    </script>
  </body>
</html>


